views:
  - title: Home
    header:
      card:
        type: markdown
        text_only: true
        content: |
          # Energy Dashboard Details
    sections:
      - type: grid
        cards:
          - type: heading
            heading: Battery
            heading_style: title
          - type: vertical-stack
            cards:
              - type: gauge
                name: Battery SoC
                entity: sensor.foxess_bat_soc
                min: 0
                max: 100
                needle: true
                severity:
                  green: 50
                  yellow: 25
                  red: 10
              - type: entity
                entity: sensor.foxess_bat_temperature
              - type: entities
                title: Inverter / Site Power
                entities:
                  - entity: sensor.foxess_solar_power
                  - entity: sensor.foxess_generation_power
                  - entity: sensor.foxess_grid_consumption
                  - entity: sensor.foxess_load_power
                  - entity: sensor.foxess_bat_charge_power
                  - entity: sensor.foxess_bat_discharge_power
                  - entity: sensor.foxess_pv_power
              - chart_type: line
                period: 5minute
                type: statistics-graph
                entities:
                  - sensor.foxess_bat_charge
                title: Battery Charge Rate
                stat_types:
                  - state
                  - change
              - chart_type: line
                period: 5minute
                type: statistics-graph
                entities:
                  - sensor.foxess_bat_discharge
                title: Battery Discharge Rate
      - type: grid
        cards:
          - type: heading
            heading_style: title
            heading: Solar
          - type: vertical-stack
            cards:
              - type: gauge
                entity: sensor.foxess_solar_power
                max: 10.5
              - chart_type: line
                period: 5minute
                type: statistics-graph
                entities:
                  - sensor.foxess_grid_consumption_power
                stat_types:
                  - mean
                  - min
                  - max
                title: Grid Use
              - chart_type: line
                period: 5minute
                type: statistics-graph
                entities:
                  - sensor.foxess_solar
                title: Solar Generation Live
                stat_types:
                  - state
              - chart_type: line
                period: 5minute
                type: statistics-graph
                entities:
                  - sensor.foxess_energy_generated
                title: Solar Generation (Today)
                stat_types:
                  - state
      - type: grid
        cards:
          - type: heading
            heading_style: title
            heading: ROI - Profit
          - type: vertical-stack
            cards:
              - type: custom:bar-card
                name: Cost if all grid
                min: 0
                max: 20
                entities:
                  - entity: sensor.cost_if_all_from_grid_today
              - type: custom:bar-card
                name: Actual grid cost
                entity: sensor.grid_cost_today
                min: 0
                max: 20
              - type: custom:bar-card
                name: Export income
                entity: sensor.export_income_today
                min: 0
                max: 5
              - type: custom:bar-card
                name: Savings today
                entity: sensor.savings_today
                min: 0
                max: 20
            title: Today
          - type: vertical-stack
            cards:
              - type: custom:mushroom-template-card
                primary: ROI summary
                secondary: >
                  Today:  ${{ states('sensor.savings_today') }} • MTD: ${{
                  states('sensor.savings_this_month') }} • Total: ${{
                  states('sensor.total_savings_to_date') }} • {{ 'Remaining' if
                  states('sensor.roi_remaining')|float(0) > 0 else 'Profit' }}:
                    ${{ (states('sensor.roi_remaining')|float(0) if states('sensor.roi_remaining')|float(0) > 0
                        else states('sensor.roi_profit_to_date')|float(0)) | round(2) }}
                icon: mdi:cash-multiple
                multiline_secondary: true
                color: >
                  {% if states('sensor.roi_profit_to_date')|float(0) > 0 %}
                  green {% elif states('sensor.roi_remaining')|float(0) < 1500
                  %} amber {% else %} red {% endif %}
                vertical: true
                features_position: bottom
              - type: custom:bar-card
                name: Payback progress
                min: 0
                max: 7500
                target: 7500
                decimal: 2
                icon: mdi:cash
                severity:
                  - from: 0
                    to: 1500
                    color: red
                  - from: 1500
                    to: 5000
                    color: orange
                  - from: 5000
                    to: 7500
                    color: green
                entities:
                  - entity: sensor.total_savings_to_date
              - type: custom:bar-card
                name: Remaining / Profit
                entity: sensor.roi_remaining
                min: -2000
                max: 7500
                decimal: 2
                icon: mdi:cash-
              - type: entities
                title: ROI details
                entities:
                  - entity: input_number.battery_purchase_price
                    name: Purchase price
                  - entity: sensor.total_savings_to_date
                    name: Total saved to date
                  - entity: sensor.roi_remaining
                    name: Remaining to payback (neg = profit)
                  - entity: sensor.roi_profit_to_date
                    name: Profit to date
            title: Life
